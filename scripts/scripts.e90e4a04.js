"use strict";angular.module("chesireApp",["ngRoute","LocalStorageModule"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"scripts/app/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]).config(["localStorageServiceProvider",function(a){a.setPrefix("chesire")}]),angular.module("chesireApp").controller("MainCtrl",function(){}),angular.module("chesireApp").service("Colorpalette",function(){return{BACKGROUND:"#1a1b1d",PARTICLES:"#BA8E3D",PARTICLES_NOTE:"#D65B27",POINTER:"#071255",PARTICLES_BACK:"#000000",BOUNDARIES:"#1a1b1d",HAND:"#660000",hex:{BACKGROUND:1710877,PARTICLES:12226109,PARTICLES_NOTE:14048039,POINTER:463445,PARTICLES_BACK:0,BOUNDARIES:77,HAND:6684672}}}),angular.module("chesireApp").factory("LastUsedSettingsStore",["$q","localStorageService",function(a,b){var c=function(){var c=a.defer();return c.resolve(b.get("lastUsedSong")),c.promise},d=function(a){b.set("lastUsedSong",a)},e=function(){var c=a.defer();return c.resolve(b.get("lastUsedSynth")),c.promise},f=function(a){b.set("lastUsedSynth",a)};return{getLastUsedSong:c,notifyLastUsedSongChanged:d,getLastUsedSynth:e,notifyLastUsedSynthChanged:f}}]),angular.module("chesireApp").factory("IdGenerator",function(){var a=(new Date).getTime(),b=function(){return a+=1};return{getUniqueId:b}}),angular.module("chesireApp").filter("frequencyToPercentage",["NoteList",function(a){var b=function(a){return Math.log(a)/Math.LN2};return function(c){var d=b(_.first(a).freq),e=b(_.last(a).freq),f=b(c);return 100*(f-d)/(e-d)}}]),angular.module("chesireApp").factory("UIService",function(){var a=[],b=function(b){angular.forEach(a,function(a){a(b)})},c=function(b){a.push(b)},d=function(b){a=_.without(a,b)};return{notifyMenuOpen:b,subscribeToMenuOpening:c,unsubscribeToMenuOpening:d}}),angular.module("chesireApp").directive("selectBox",function(){return{templateUrl:"scripts/select-box/select-box.html",restrict:"E",scope:{value:"=",valueList:"=",attrToShow:"@"},controller:"SelectBoxCtrl"}}),angular.module("chesireApp").controller("SelectBoxCtrl",["$scope",function(a){var b=function(){a.listExpanded=!1};a.toggleList=function(){a.listExpanded=!a.listExpanded},a.selectValue=function(b){a.value=b,a.listExpanded=!1},b()}]),angular.module("chesireApp").directive("customCheckbox",function(){return{templateUrl:"scripts/custom-checkbox/custom-checkbox.html",restrict:"E",replace:!0,scope:{value:"="}}}),angular.module("chesireApp").factory("Leapmotion",["$rootScope",function(a){var b={fingers:0,hands:0,iterations:0,connected:!1},c={id:!1,frame:null},d=50,e=500,f=150,g=1e3,h=0,i=.5,j=-.3,k=.5,l=-.5,m=-1,n=.45,o=2.6,p=-.9,q=0,r=[],s=5,t=null,u=function(){if(!Leap)throw"Error, LeapMotion library was not loaded";var a=new Leap.Controller;return a.on("animationFrame",v),a.on("connect",x),a.on("deviceStreaming/deviceStreaming",y),a.on("deviceStreaming/deviceStopped",z),a.connect(),Leap},v=function(d){a.$apply(function(){b.iterations++,b.fingers=d.fingers.length,b.hands=d.hands.length,c.frame=d,c.id=d.id,w(c)})},w=function(a){angular.forEach(r,function(b){b(a)})},x=function(){b.connected=!0,a.$apply()},y=function(){b.connected=!0,a.$apply()},z=function(){b.connected=!1,a.$apply()},A=function(){return b},B=function(){return c},C=function(a,b){var c=b[0].palmPosition,f=D(c,a),g=b[0].palmVelocity,j=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]);return f.handVelocity=L((j-d)/(e-d)),f.handDirectionX=L((b[0].direction[0]-h)/(i-h)),f.handDirectionY=G(b[0]),f.handDirectionZ=L((b[0].direction[2]-l)/(m-l)),f.fingerVelocity=J(b[0]),f.handAperture=E(b[0]),f.fingerDirectionY=F(b[0]),f},D=function(a,b){var c={};return c.x=L((a[0]-(b.interactionBox.center[0]-b.interactionBox.size[0]/2))/b.interactionBox.size[0]),c.y=L((a[1]-(b.interactionBox.center[1]-b.interactionBox.size[1]/2))/b.interactionBox.size[1]),c.z=L((a[2]-(b.interactionBox.center[2]-b.interactionBox.size[2]/2))/b.interactionBox.size[2]),c},E=function(a){var b=0;if(a.fingers.length>2){for(var c=0;c<a.fingers.length;c++)for(var d=0;d<a.fingers.length;d++)c!==d&&(b+=I(a.fingers[c],a.fingers[d]));b/=a.fingers.length,b=L((b-n)/(o-n))}return H(b)},F=function(a){if(a.fingers.length){for(var b=0,c=0,d=0;d<a.fingers.length;d++)0!==a.fingers[d].type&&(b+=a.fingers[d].direction[1],c++);if(c)return b/=c,1-L((b-p)/(q-p))}return G()},G=function(a){return 1-L((a.direction[1]-j)/(k-j))},H=function(a){t=t||Array.apply(null,new Array(s)).map(Number.prototype.valueOf,0),t.pop(),t.splice(0,0,a);for(var b=0,c=0;s>c;c++)b+=t[c];return b/s},I=function(a,b){var c=a.direction[0]*b.direction[0]+a.direction[2]*b.direction[2],d=Math.sqrt(a.direction[0]*a.direction[0]+a.direction[2]*a.direction[2]),e=Math.sqrt(b.direction[0]*b.direction[0]+b.direction[2]*b.direction[2]),f=c/(d*e);return Math.abs(Math.acos(f))},J=function(a){if(a.fingers.length){for(var b=0,c=0;c<a.fingers.length;c++)b+=K(a.fingers[c],a);return L((b-f)/(g-f))}return 0},K=function(a,b){var c=a.tipVelocity[0]-b.palmVelocity[0],d=a.tipVelocity[1]-b.palmVelocity[1],e=a.tipVelocity[2]-b.palmVelocity[2];return Math.sqrt(c*c+d*d+e*e)},L=function(a){return 0>a?0:a>1?1:a},M=function(a){r.push(a)},N=u();return{leapObject:N,getStats:A,getFrameInfo:B,getRelativePositions:C,subscribeToFrameChange:M,getRelativePositionXYZ:D}}]),angular.module("chesireApp").service("Three",function(){if(!THREE)throw"Error, Three.js library was not loaded";return THREE}),angular.module("chesireApp").factory("Audiocontext",function(){var a=window.AudioContext||window.webkitAudioContext;if(!a)throw"Error, AudioContext not available in your browser";return new a}),angular.module("chesireApp").service("requestanimationframe",function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame}),angular.module("chesireApp").directive("scaleoptions",function(){return{templateUrl:"scripts/scale-options/scale-options.html",restrict:"E",scope:{},controller:"ScaleoptionsCtrl"}}),angular.module("chesireApp").controller("ScaleoptionsCtrl",["$scope","DefaultScale","ScalesHelper","ScaleOptions","SongStore","UIService",function(a,b,c,d,e,f){var g=null;a.expanded=!1,a.listOfSongsExpanded=!1;var h=function(){d.getScaleOptions().then(function(b){a.currentScale=angular.copy(b),k(a.currentScale.chords),e.getSongs().then(j),e.subscribeToChangeInAllSongs(j),f.subscribeToMenuOpening(i)})},i=function(b){"scale"!==b&&(a.expanded=!1)};a.onChordChange=function(a,b){var c=angular.copy(g);c[a]=angular.copy(b),k(c)};var j=function(b){a.availableSongs=b},k=function(b){c.isSameSetOfChords(b,g)||(g=angular.copy(b),a.currentScale.chords=angular.copy(b),d.setScaleOptions(a.currentScale))};a.toggle=function(){a.expanded=!a.expanded,a.listOfSongsExpanded=!1,a.expanded&&f.notifyMenuOpen("scale")},a.saveSong=function(){e.saveSong(a.currentScale)},a.deleteSong=function(){e.deleteSong(a.currentScale)},a.toggleListOfSongs=function(){a.listOfSongsExpanded=!a.listOfSongsExpanded},a.selectSong=function(b){a.listOfSongsExpanded=!1,a.currentScale=b,k(b.chords)},a.removeChordFromSong=function(b){a.currentScale.chords.length>2&&(a.currentScale.chords.splice(b,1),k(a.currentScale.chords))},a.addChord=function(){a.currentScale.chords.push(c.getEmptyChord()),k(a.currentScale.chords)},h()}]),angular.module("chesireApp").factory("ScaleOptions",["$q","LastUsedSettingsStore","DefaultScale",function(a,b,c){var d=null,e=[],f=function(a){d=a,i(a),b.notifyLastUsedSongChanged(a)},g=function(){var e=a.defer();return d?e.resolve(d):b.getLastUsedSong().then(function(a){a||(a=c),d=a,e.resolve(a)}),e.promise},h=function(a){e.push(a)},i=function(a){angular.forEach(e,function(b){b(a)})};return{setScaleOptions:f,getScaleOptions:g,subscribeToChangesInScaleOptions:h}}]),angular.module("chesireApp").factory("SongStore",["$q","localStorageService",function(a,b){var c=[],d=function(){var c=a.defer();return c.resolve(b.get("songs")||[]),c.promise},e=function(c){var d=a.defer();if(c&&c.name&&c.chords&&c.chords.length){var e=b.get("songs");e=e?angular.fromJson(e):[];var f=g(c,e);f?f.chords=c.chords:e.push(c),b.set("songs",e),d.promise.then(j),d.resolve(e)}else d.reject("Error saving song, bad config");return d.promise},f=function(c){var d=a.defer(),e=b.get("songs"),f=g(c,e);return e=_.without(e,f),b.set("songs",e),d.promise.then(j),d.resolve(e),d.promise},g=function(a,b){for(var c=0;c<b.length;c++)if(b[c].name===a.name)return b[c];return!1},h=function(a){c.push(a)},i=function(a){c=_.without(c,a)},j=function(a){angular.forEach(c,function(b){b(a)})};return{getSongs:d,saveSong:e,deleteSong:f,subscribeToChangeInAllSongs:h,unsubscribeToChangeInAllSongs:i}}]),angular.module("chesireApp").controller("SoundgeneratorCtrl",["$scope","$timeout","$q","Leapmotion","SynthClass","ScaleOptions","SynthOptions","CurrentSynth",function(a,b,c,d,e,f,g,h){var i=null,j=null,k=new e;h.setCurrentSynth(k);var l=function(){var a=c.all([g.getSynthOptions(),f.getScaleOptions()]);a.then(m)},m=function(a){i=a[0],j=a[1],g.subscribeToChangesInSynthOptions(o),f.subscribeToChangesInScaleOptions(n),d.subscribeToFrameChange(p),o(i)},n=function(a){k.scaleChanged(a)},o=function(a){i=a,k.destroy(),k=new e(a,j),h.setCurrentSynth(k),"midi"===i.outputMode&&k.disable()},p=function(a){var b=a.frame;if(b.hands.length){var c=d.getRelativePositions(b,b.hands);k.updateSound(b.hands[0],c)}else k.stopPlaying()};l()}]),angular.module("chesireApp").directive("soundgenerator",function(){return{restrict:"E",templateUrl:"scripts/sound-generator/sound-generator.html",scope:{},controller:"SoundgeneratorCtrl"}}),angular.module("chesireApp").constant("AvailableOscillators",["sawtooth","sine","square","triangle"]),angular.module("chesireApp").factory("OscillatorCollection",["Audiocontext","MultiNotesHelper",function(a,b){var c=function(c){var d=[],e={},f=null,g=function(a){f=a,angular.forEach(d,function(b){b.gainNode.connect(a)})},h=function(a){var b,c;angular.forEach(a,function(a){b=d[e[a.name]],c=a.freqToPlay,b.gainNode.gain.value=a.gain,c&&(b.oscillator.frequency.value=c)})},i=function(){for(var a=0;a<d.length;a++)d[a].oscillator.disconnect(d[a].gainNode),f&&d[a].gainNode.disconnect(f);d=[]},j=function(a){return a?a.oscillatorType||"sine":"sine"},k=function(c,h){if(i(),c){var k=b.getNotesDefinition(c,h);d=[],e={};for(var l=0;l<k.length;l++){var m=a.createOscillator(),n=a.createGain();n.gain.value=0,m.connect(n),m.start(0),e[k[l].name]=l,d.push({oscillator:m,gainNode:n})}f&&g(f)}angular.forEach(d,function(a){a.oscillator.type=j(h)})},l=function(){return d};return k(void 0,c),{connect:g,updateNodes:h,destroy:i,init:k,getNodes:l}};return c}]),angular.module("chesireApp").factory("OscillatorClass",["MultiNotesHelper","OscillatorCollection","Audiocontext","MotionParamsHelper",function(a,b,c,d){var e=function(a){a&&this.init(a)};return e.prototype={connectedTo:null,DEFAULT_GAIN:1,MIN_GAIN_CHANGE:.05,init:function(a){this.options=a,this.oscillatorCollection&&this.oscillatorCollection.destroy(),this.oscillatorCollection=new b(a),this.gainController=c.createGain(),this.oscillatorCollection.connect(this.gainController)},changeScale:function(a){this.oscillatorCollection&&this.oscillatorCollection.destroy(),this.oscillatorCollection.init(a,this.options)},updateSound:function(a){this._updateNotesBeingPlayed(a.x),this._updateGain(a)},_updateNotesBeingPlayed:function(b){var c=a.getNotesInfo(b,this.options.transitionType);this.oscillatorCollection.updateNodes(c)},_updateGain:function(a){var b=this.DEFAULT_GAIN;this.options.controls&&this.options.controls.gain&&(b=d.getParamValue(this.options.controls.gain,a)),this._setGainControllerValue(b)},stopPlaying:function(){this._setGainControllerValue(0)},_setGainControllerValue:function(a){var b=this.gainController.gain.value;b!==a&&((0===b||1===b)&&(this.gainController.gain.value=a),Math.abs(b-a)>this.MIN_GAIN_CHANGE&&(this.gainController.gain.value=a))},connectTo:function(a){"AudioDestinationNode"!==a.constructor.name&&(a=a.getAudioNode()),this.connectedTo=a,this.gainController.connect(a)},destroy:function(){this.oscillatorCollection&&this.oscillatorCollection.destroy(),this.connectedTo&&this.gainController&&(this.gainController.disconnect(),this.connectedTo=null)}},e}]),angular.module("chesireApp").directive("synthcomponent",["$rootScope","$compile",function(a,b){var c=function(c){var d="Error, component directive not found";switch(c.type){case"oscillator":d="<oscillator/>"}var e=angular.element(d),f=a.$new(!0);return f.componentInfo=c,b(e)(f)};return{template:"",restrict:"E",scope:{componentInfo:"="},link:function(a,b){var d=c(a.componentInfo);b.append(d)}}}]),angular.module("chesireApp").factory("CurrentSynth",function(){var a=null,b=[],c=function(c){a=c,angular.forEach(b,function(a){a(c)})},d=function(){return a},e=function(a){b.push(a)};return{setCurrentSynth:c,getCurrentSynth:d,subscribeToChangesInCurrentSynth:e}}),angular.module("chesireApp").factory("SynthClass",["Audiocontext","SynthElementFactory","SynthOptionsHelper",function(a,b,c){var d=function(a,b){a&&b&&this.init(a,b)};return d.prototype={synthElements:null,init:function(a,b){this.synthOptions=angular.copy(a),this.scaleOptions=angular.copy(b),this.synthElements=[],this._createComponents(),this.scaleChanged(this.scaleOptions)},getComponent:function(a){return _.find(this.synthElements,function(b){return b.options.uniqueId===a.uniqueId})},_createComponents:function(){if(!this._areOptionsCorrect())throw"SynthClass: error creating components, wrong options";var c=this;angular.forEach(this.synthOptions.components,function(a){c.synthElements.push(b.createSynthElement(a))});for(var d=0;d<this.synthElements.length-1;d++)this.synthElements[d].connectTo(this.synthElements[d+1]);_.last(this.synthElements).connectTo(a.destination)},_areOptionsCorrect:function(){if(this.synthOptions){var a=c.getOscillatorFromOptions(this.synthOptions),b=a&&"oscillator"===a.type;return b}return!1},scaleChanged:function(a){this.scaleOptions=a,angular.forEach(this.synthElements,function(b){b.changeScale&&b.changeScale(a)})},stopPlaying:function(){angular.forEach(this.synthElements,function(a){a.stopPlaying&&a.stopPlaying()})},updateSound:function(a,b){angular.forEach(this.synthElements,function(a){a.updateSound&&a.updateSound(b)})},disable:function(){_.last(this.synthElements).gainController.disconnect(a.destination)},destroy:function(){angular.forEach(this.synthElements,function(a){a.destroy()}),this.synthElements=[]}},d}]),angular.module("chesireApp").factory("SynthElementFactory",["OscillatorClass","TremoloClass",function(a,b){var c=function(c){switch(c.type){case"oscillator":return new a(c);case"tremolo":return new b(c);default:throw"Error creating SynthElement, wrong type: "+c.type}};return{createSynthElement:c}}]),angular.module("chesireApp").factory("TremoloClass",["Audiocontext","MotionParamsHelper",function(a,b){var c=function(a){a&&this.init(a)};return c.prototype={DEFAULT_RATE:10,DEFAULT_DEPTH:.2,init:function(b){this.options=b,this.gainController=a.createGain(),this.oscillator=a.createOscillator(),this.oscillator.connect(this.gainController.gain),this.oscillator.type=this.oscillator.SINE},getAudioNode:function(){return this.gainController},updateSound:function(a){var c=this.DEFAULT_RATE;this.options.controls&&this.options.controls.rate&&(c=b.getParamValue(this.options.controls.rate,a)),console.log(c),this._setRateValue(c)},_setRateValue:function(a){this.oscillator.frequency.value!==a&&(this.oscillator.frequency.value=a)},connectTo:function(a){"AudioDestinationNode"!==a.constructor.name&&(a=a.getAudioNode()),this.connectedTo=a,this.gainController.connect(a)},destroy:function(){this.connectedTo&&this.gainController&&(this.gainController.disconnect(),this.connectedTo=null)}},c}]),angular.module("chesireApp").directive("synthoptions",function(){return{templateUrl:"scripts/synth-options/synth-options.html",restrict:"E",scope:{},controller:"SynthoptionsCtrl"}}),angular.module("chesireApp").controller("SynthoptionsCtrl",["$scope","SynthOptions","UIService","DefaultEmptyControl",function(a,b,c,d){var e=function(){b.getSynthOptions().then(function(b){a.synthoptions=b}),c.subscribeToMenuOpening(f),a.outputModes=[{name:"Audio",value:"audio"},{name:"MIDI",value:"midi"}],a.$watch("synthoptions.outputMode",function(c){c&&b.setSynthOptions(a.synthoptions)})},f=function(b){"synth-options"!==b&&(a.expanded=!1)};a.toggle=function(){a.expanded=!a.expanded,a.listOfSynthsExpanded=!1,a.expanded&&c.notifyMenuOpen("synth-options")},a.saveSong=function(){},a.deleteSong=function(){},a.toggleListOfSynths=function(){a.listOfSynthsExpanded=!a.listOfSynthsExpanded},a.selectSynth=function(b){a.listOfSynthsExpanded=!1,a.synthoptions=b},a.addControl=function(){a.synthoptions.controls.push(angular.copy(d))},e()}]),angular.module("chesireApp").factory("SynthOptions",["$q","LastUsedSettingsStore","DefaultSynth","IdGenerator",function(a,b,c,d){var e=null,f=[],g=function(a){e=a,i(),k(e),b.notifyLastUsedSynthChanged(e)},h=function(){var d=a.defer();return e?d.resolve(e):b.getLastUsedSynth().then(function(a){a||(a=c),e=a,i(),d.resolve(e)}),d.promise},i=function(){angular.forEach(e.components,function(a){a.uniqueId||(a.uniqueId=d.getUniqueId())}),angular.forEach(e.controls,function(a){a.uniqueId||(a.uniqueId=d.getUniqueId())})},j=function(a){f.push(a)},k=function(a){angular.forEach(f,function(b){b(a)})},l=function(a){for(var c=0;c<e.components.length;c++)if(e.components[c].uniqueId===a.uniqueId){e.components[c]=a;break}k(e),b.notifyLastUsedSynthChanged(e)},m=function(a){a.uniqueId||(a.uniqueId=d.getUniqueId());for(var c=0;c<e.controls.length;c++)if(e.controls[c].uniqueId===a.uniqueId){e.controls[c]=a;break}k(e),b.notifyLastUsedSynthChanged(e)},n=function(a){e.controls=_.without(e.controls,a),k(e),b.notifyLastUsedSynthChanged(e)};return{setSynthOptions:g,getSynthOptions:h,subscribeToChangesInSynthOptions:j,notifyComponentChanged:l,notifyControlChanged:m,notifyControlRemoved:n}}]),angular.module("chesireApp").factory("SynthOptionsHelper",function(){var a=function(a){return a&&a.components?_.findWhere(a.components,{type:"oscillator"}):null};return{getOscillatorFromOptions:a}}),angular.module("chesireApp").directive("responseFunction",function(){return{templateUrl:"scripts/synth-options/response-function.html",restrict:"E",scope:{responseFunctionInfo:"="},controller:"ResponseFunctionCtrl"}}),angular.module("chesireApp").controller("ResponseFunctionCtrl",["$scope","ResponseFunctions",function(a,b){var c=20,d=function(){a.availableResponseFunctions=b,a.$watch("selectedResponseFunction",e),a.selectedResponseFunction=b[a.responseFunctionInfo.name],a.$watch("responseFunctionInfo",g,!0)},e=function(b){a.responseFunctionInfo.name!==b.name&&(a.responseFunctionInfo.name=b.name)},f=function(){a.responseFunctionValues=[];var b,d,e=1/c;a.responseFunctionIncrement=e;for(var f=0;c>f;f++)d=f*e,b=a.selectedResponseFunction.getResponse(d,a.responseFunctionInfo),a.responseFunctionValues.push({x:d,y:b})},g=function(){f()};d()}]),angular.module("chesireApp").factory("ResponseFunctions",function(){var a={min:{name:"Minimum",value:0},max:{name:"Maximum",value:1},inverse:{name:"Inverse",value:!1}},b={name:"linear",params:a,getResponse:function(b,c){var d=c.max||a.max.value,e=c.min||a.min.value,f=c.inverse||a.inverse.value,g=e+b*(d-e);return f&&(g=d-b*(d-e)),e>g&&(g=e),g>d&&(g=d),g}},c={step:{name:"Step",value:.5},inverse:{name:"Inverse",value:!1},stepOn:{name:"StepOn",value:1},stepOff:{name:"StepOff",value:0}},d={name:"step",params:c,getResponse:function(a,b){var d,e=b.step||c.step.value,f=b.inverse||c.inverse.value,g=b.stepOn||c.stepOn.value,h=b.stepOff||c.stepOff.value;return f?(d=g,a>e&&(d=h)):(d=h,a>e&&(d=g)),d}};return{linear:b,step:d}}),angular.module("chesireApp").directive("control",function(){return{templateUrl:"scripts/synth-options/control.html",restrict:"E",scope:{controlInfo:"="},controller:"ControlCtrl"}}),angular.module("chesireApp").controller("ControlCtrl",["$scope","MidiControlMessages","SynthOptions","CurrentMidiOutput",function(a,b,c,d){var e=function(){a.controlListExpanded=!1,a.midiControlMessages=b,a.$watch("controlInfo.number",f),a.$watch("currentControlMessage.number",h),a.$watch("controlInfo.param",g),a.$watch("controlInfo.responseFunction",_.throttle(g,500),!0)},f=function(c){a.currentControlMessage=_.findWhere(b,{number:c})},g=function(b){b&&(a.controlInfo.responseFunction.min=parseFloat(a.controlInfo.responseFunction.min),a.controlInfo.responseFunction.max=parseFloat(a.controlInfo.responseFunction.max),c.notifyControlChanged(a.controlInfo))},h=function(b,d){b!==d&&(a.controlInfo.number=b,c.notifyControlChanged(a.controlInfo))};a.toggleControlList=function(){a.controlListExpanded=!a.controlListExpanded},a.selectControl=function(b){a.controlInfo.number=b.number,a.controlListExpanded=!1,c.notifyControlChanged(a.controlInfo)},a.removeControl=function(){c.notifyControlRemoved(a.controlInfo)},a.pingControl=function(){d.getCurrentOutput().pingControl(a.controlInfo.number)},e()}]),angular.module("chesireApp").directive("gestureSelector",function(){return{templateUrl:"scripts/synth-options/gesture-selector.html",restrict:"E",controller:"GestureSelectorCtrl",scope:{gestureObject:"="}}}),angular.module("chesireApp").controller("GestureSelectorCtrl",["$scope","MotionParamsList",function(a,b){var c=function(){a.availableGestures=b};c()}]),angular.module("chesireApp").directive("responseFunctionParam",function(){return{templateUrl:"scripts/synth-options/response-function-param.html",restrict:"E",scope:{paramParentObject:"=",paramKey:"=",paramInfo:"="},controller:"ResponseFunctionParamCtrl"}}),angular.module("chesireApp").controller("ResponseFunctionParamCtrl",["$scope",function(a){var b=function(){a.$watch("selectedValue",c),a.selectedValue=a.paramParentObject[a.paramKey]||a.paramInfo.value,a.isBoolean=_.isBoolean(a.paramInfo.value),a.isNumber=_.isNumber(a.paramInfo.value)},c=function(b){a.paramParentObject[a.paramKey]!==b&&(a.isNumber&&(b=parseFloat(b)),a.paramParentObject[a.paramKey]=b)};b()}]),angular.module("chesireApp").constant("DefaultEmptyControl",{number:1,param:"y",responseFunction:{inverse:!1,min:0,max:0,name:"linear"}}),angular.module("chesireApp").directive("midiOutputSelector",function(){return{templateUrl:"scripts/synth-options/midi-output-selector/midi-output-selector.html",restrict:"E",scope:{},controller:"MidiOutputSelectorCtrl"}}),angular.module("chesireApp").controller("MidiOutputSelectorCtrl",["$scope","MidiApiMediator","CurrentMidiOutput",function(a,b,c){var d=function(){a.loading=!0,c.whenReady().then(function(){b.then(function(b){a.midiOutputs=b.outputs(),a.loading=!1}),e(c.getCurrentOutput()),a.$watch(function(){return c.getCurrentOutput()},e),a.$watch("selectedMidiOutput.id",f)})},e=function(b){a.selectedMidiOutput=b},f=function(b){var d=c.getCurrentOutput();d.id!==b&&c.setCurrentOutput(a.selectedMidiOutput)};d()}]),angular.module("chesireApp").directive("threeparticles",function(){return{restrict:"E",controller:"ThreeparticlesCtrl",scope:{},link:function(a,b){a.init(b)}}}),angular.module("chesireApp").controller("ThreeparticlesCtrl",["$scope","$timeout","$q","Three","Leapmotion","Colorpalette","ScaleOptions","SpaceConverter","HandModel","BoundariesModel","PointerModel","SoundMeshModel","VisualizationKeyHelper","Camera","ChordsHelperModel",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=c.defer(),q=null,r=null,s=null,t=null,u=null,v=null;a.init=function(c){b(function(){x(c),a.frameInfo=e.getFrameInfo(),a.$watch("frameInfo.id",a.frameInfoChanged),a.renderer.render(a.scene,v.getCamera()),p.resolve(!0)}),g.subscribeToChangesInScaleOptions(w)};var w=function(b){b&&p.promise.then(function(){m.createKeyRanges(b),t&&t.destroy(),u&&u.destroy(),u=new o(a.scene)})},x=function(b){b.addClass("chesirecanvas");var c=b[0].offsetHeight,e=b[0].offsetWidth;a.scene=new d.Scene,s=new k(a.scene),q=new i(a.scene),r=new j(a.scene),v=new n(a.scene,{screenHeight:c,screenWidth:e}),a.pointLight=new d.PointLight(16777215),a.pointLight.position.set(10,150,130),a.scene.add(a.pointLight),a.renderer=new d.WebGLRenderer,a.renderer.setClearColor(f.hex.BACKGROUND,1),a.renderer.setSize(e,c),b.append(a.renderer.domElement)};a.frameInfoChanged=function(){var b=e.getFrameInfo().frame;if(b){if(b.hands.length){var c=e.getRelativePositions(b,b.hands),d=h.getConvertedPosition(c);q.update(b.hands[0],b),s.update(d),u.update(c.x)}a.renderer.render(a.scene,v.getCamera())}}}]),angular.module("chesireApp").factory("SpaceConverter",function(){var a={width:221,height:221,depth:154},b={xMin:-(a.width/2),xMax:a.width/2,yMin:0,yMax:a.height,zMin:-(a.depth/2),zMax:a.depth/2},c=function(){return b},d=function(a){return{x:a.x*(b.xMax-b.xMin)+b.xMin,y:a.y*(b.yMax-b.yMin)+b.yMin,z:a.z*(b.zMax-b.zMin)+b.zMin}},e=function(){return a},f=function(){return{x:(b.xMax-b.xMin)/2+b.xMin,y:(b.yMax-b.yMin)/2+b.yMin,z:(b.zMax-b.zMin)/2+b.zMin}};return{getBoxSize:e,getBoxLimits:c,getBoxCenter:f,getConvertedPosition:d}}),angular.module("chesireApp").factory("HandModel",["Three","Colorpalette","SpaceConverter","Leapmotion",function(a,b,c,d){var e,f=.5,g=["pinky","indexFinger","ringFinger","middleFinger"],h=8,i=6,j=5,k=5,l=8,m=function(a){this._scene=a,this._createHand()};return m.prototype._createHand=function(){this._handGeometry=this._createGeometry();var c=new a.MeshLambertMaterial({color:b.hex.HAND,transparent:!0,opacity:f}),d=new a.Mesh(this._handGeometry,c);this._scene.add(d)},m.prototype._createGeometry=function(){var b=new a.Geometry;e=0;for(var c=0;c<g.length;c++){this[g[c]]={verticesStart:e};for(var d=0;h>d;d++)b.vertices.push(new a.Vector3(1,1,1));this._createFacesForFinger(b,e),e+=h}return this._createThumb(b),this._createPalm(b),b.computeFaceNormals(),b},m.prototype._createThumb=function(b){for(var c=0;i>c;c++)b.vertices.push(new a.Vector3(1,1,1));this.thumb={verticesStart:e},b.faces.push(new a.Face3(e+0,e+2,e+1)),b.faces.push(new a.Face3(e+1,e+2,e+3)),b.faces.push(new a.Face3(e+2,e+4,e+3)),b.faces.push(new a.Face3(e+3,e+4,e+5)),b.faces.push(new a.Face3(e+0,e+1,e+2)),b.faces.push(new a.Face3(e+1,e+3,e+2)),b.faces.push(new a.Face3(e+2,e+3,e+4)),b.faces.push(new a.Face3(e+3,e+5,e+4)),e+=i},m.prototype._createPalm=function(b){for(var c=0;j>c;c++)b.vertices.push(new a.Vector3(1,1,1));this.palm={verticesStart:e},b.faces.push(new a.Face3(e+0,e+1,e+3)),b.faces.push(new a.Face3(e+0,e+2,e+3)),b.faces.push(new a.Face3(e+2,e+4,e+3)),b.faces.push(new a.Face3(e+0,e+3,e+1)),b.faces.push(new a.Face3(e+0,e+3,e+2)),b.faces.push(new a.Face3(e+2,e+3,e+4)),e+=j},m.prototype._createFacesForFinger=function(b,c){b.faces.push(new a.Face3(c+0,c+2,c+1)),b.faces.push(new a.Face3(c+1,c+2,c+3)),b.faces.push(new a.Face3(c+2,c+4,c+3)),b.faces.push(new a.Face3(c+3,c+4,c+5)),b.faces.push(new a.Face3(c+4,c+6,c+5)),b.faces.push(new a.Face3(c+5,c+6,c+7)),b.faces.push(new a.Face3(c+0,c+1,c+2)),b.faces.push(new a.Face3(c+1,c+3,c+2)),b.faces.push(new a.Face3(c+2,c+3,c+4)),b.faces.push(new a.Face3(c+3,c+5,c+4)),b.faces.push(new a.Face3(c+4,c+5,c+6)),b.faces.push(new a.Face3(c+5,c+7,c+6))},m.prototype.update=function(a,b){this._lastFrame=b;for(var c=0;c<g.length;c++)this._updateVerticesForFinger(g[c],a[g[c]]);this._updateVerticesForThumb(a.thumb),this._updateVerticesForPalm(a),this._handGeometry.computeFaceNormals(),this._handGeometry.normalsNeedUpdate=!0,this._handGeometry.verticesNeedUpdate=!0},m.prototype._updateVerticesForFinger=function(a,b){var c=this[a].verticesStart;this._updateFingerVertice(this._handGeometry.vertices[c+0],b.positions[1],!0),this._updateFingerVertice(this._handGeometry.vertices[c+1],b.positions[1],!1),this._updateFingerVertice(this._handGeometry.vertices[c+2],b.positions[2],!0),this._updateFingerVertice(this._handGeometry.vertices[c+3],b.positions[2],!1),this._updateFingerVertice(this._handGeometry.vertices[c+4],b.positions[3],!0),this._updateFingerVertice(this._handGeometry.vertices[c+5],b.positions[3],!1),this._updateFingerVertice(this._handGeometry.vertices[c+6],b.positions[4],!0),this._updateFingerVertice(this._handGeometry.vertices[c+7],b.positions[4],!1)},m.prototype._updateVerticesForThumb=function(a){var b=this.thumb.verticesStart;this._updateThumbVertice(this._handGeometry.vertices[b+0],a.positions[2],!0),this._updateThumbVertice(this._handGeometry.vertices[b+1],a.positions[2],!1),this._updateThumbVertice(this._handGeometry.vertices[b+2],a.positions[3],!0),this._updateThumbVertice(this._handGeometry.vertices[b+3],a.positions[3],!1),this._updateThumbVertice(this._handGeometry.vertices[b+4],a.positions[4],!0),this._updateThumbVertice(this._handGeometry.vertices[b+5],a.positions[4],!1)},m.prototype._updateVerticesForPalm=function(a){var b=this.palm.verticesStart;this._updatePalmVertice(this._handGeometry.vertices[b+0],a.pinky.bones[0].prevJoint),this._updateThumbVertice(this._handGeometry.vertices[b+1],a.pinky.bones[0].nextJoint),this._updateThumbVertice(this._handGeometry.vertices[b+2],a.indexFinger.bones[0].prevJoint),this._updateThumbVertice(this._handGeometry.vertices[b+3],a.indexFinger.bones[0].nextJoint),this._updateThumbVertice(this._handGeometry.vertices[b+4],a.thumb.bones[2].prevJoint)},m.prototype._updatePalmVertice=function(a,b){this._updateVertice(a,b)},m.prototype._updateFingerVertice=function(a,b,c){var d=k;c&&(d=-d),this._updateVertice(a,[b[0]+d,b[1],b[2]])},m.prototype._updateThumbVertice=function(a,b,c){var d=l;c&&(d=-d),this._updateVertice(a,[b[0]+d,b[1],b[2]])},m.prototype._updateVertice=function(a,b){var e=d.getRelativePositionXYZ(b,this._lastFrame),f=c.getConvertedPosition(e);a.x=f.x,a.y=f.y,a.z=f.z},m}]),angular.module("chesireApp").factory("BoundariesModel",["Three","Colorpalette","SpaceConverter",function(a,b,c){var d=function(a){this._scene=a,this._sceneDimensions=c.getBoxLimits(),this._createBoundaries()};return d.prototype._createBoundaries=function(){var c=new a.Geometry,d=new a.MeshLambertMaterial({color:b.hex.BOUNDARIES,transparent:!0,opacity:.15}),e=this._sceneDimensions.yMax;c.vertices.push(new a.Vector3(this._sceneDimensions.xMin,this._sceneDimensions.yMin,this._sceneDimensions.zMin)),c.vertices.push(new a.Vector3(this._sceneDimensions.xMin,this._sceneDimensions.yMin,this._sceneDimensions.zMax)),c.vertices.push(new a.Vector3(this._sceneDimensions.xMin,e,this._sceneDimensions.zMin)),c.vertices.push(new a.Vector3(this._sceneDimensions.xMin,e,this._sceneDimensions.zMax)),c.vertices.push(new a.Vector3(this._sceneDimensions.xMax,this._sceneDimensions.yMin,this._sceneDimensions.zMin)),c.vertices.push(new a.Vector3(this._sceneDimensions.xMax,this._sceneDimensions.yMin,this._sceneDimensions.zMax)),c.vertices.push(new a.Vector3(this._sceneDimensions.xMax,e,this._sceneDimensions.zMin)),c.vertices.push(new a.Vector3(this._sceneDimensions.xMax,e,this._sceneDimensions.zMax));var f=new a.Face3(0,2,1),g=new a.Face3(1,2,3),h=new a.Face3(0,4,2),i=new a.Face3(2,4,6),j=new a.Face3(7,6,4),k=new a.Face3(7,4,5),l=new a.Face3(2,3,6),m=new a.Face3(3,7,6),n=new a.Face3(2,6,3),o=new a.Face3(3,6,7),p=new a.Face3(0,1,4),q=new a.Face3(0,4,1),r=new a.Face3(4,1,5),s=new a.Face3(4,5,1);c.faces.push(f),c.faces.push(g),c.faces.push(h),c.faces.push(i),c.faces.push(j),c.faces.push(k),c.faces.push(l),c.faces.push(m),c.faces.push(n),c.faces.push(o),c.faces.push(p),c.faces.push(q),c.faces.push(r),c.faces.push(s),c.computeFaceNormals();var t=new a.Mesh(c,d);this._scene.add(t)},d}]),angular.module("chesireApp").factory("PointerModel",["Three","Colorpalette",function(a,b){var c=6,d=3,e=function(a){this._scene=a,this._createPointer()};return e.prototype._createPointer=function(){var d=new a.CubeGeometry(c,c,c),e=new a.MeshLambertMaterial({color:b.hex.POINTER,transparent:!0,opacity:.75});this.pointerElement=new a.Mesh(d,e),this.pointerElement.position.set(-1.5,0,4),this._scene.add(this.pointerElement)},e.prototype.update=function(a){this.pointerElement.position.set(a.x,a.y+d,a.z)},e}]),angular.module("chesireApp").service("SoundMeshModel",["Three","Colorpalette","SpaceConverter","VisualizationKeyHelper",function(a,b,c,d){var e=c.getBoxSize().width/2,f=c.getBoxSize().depth/2,g=50,h=.05,i=function(a){
this._scene=a,this._sceneDimensions=c.getBoxLimits(),this._createSoundMesh()};return i.prototype._createSoundMesh=function(){this._soundMeshGeometry=new a.Geometry,this._soundMeshGeometry.dynamic=!0;var c,g,h,i,j,k,l,m=(this._sceneDimensions.xMax-this._sceneDimensions.xMin)/e,n=(this._sceneDimensions.zMax-this._sceneDimensions.zMin)/f,o=new a.MeshLambertMaterial({color:b.hex.PARTICLES,vertexColors:a.FaceColors}),p=0;for(c=0;e>c;c++)for(g=0;f>g;g++){h=c*m+this._sceneDimensions.xMin,i=0,j=g*n+this._sceneDimensions.zMin,k=(c+1)*m+this._sceneDimensions.xMin,l=(g+1)*n+this._sceneDimensions.zMin,this._soundMeshGeometry.vertices.push(new a.Vector3(h,i,j)),this._soundMeshGeometry.vertices.push(new a.Vector3(h,i,l)),this._soundMeshGeometry.vertices.push(new a.Vector3(k,i,j)),this._soundMeshGeometry.vertices.push(new a.Vector3(k,i,l));var q=new a.Face3(p+1,p+2,p),r=new a.Face3(p+1,p+3,p+2),s=new a.Face3(p,p+2,p+1),t=new a.Face3(p+2,p+3,p+1);d.isParticleInKey(h)?(q.color.setHex(b.hex.PARTICLES_NOTE),r.color.setHex(b.hex.PARTICLES_NOTE)):(q.color.setHex(b.hex.PARTICLES),r.color.setHex(b.hex.PARTICLES)),s.color.setHex(b.hex.PARTICLES_BACK),t.color.setHex(b.hex.PARTICLES_BACK),this._soundMeshGeometry.faces.push(q),this._soundMeshGeometry.faces.push(r),this._soundMeshGeometry.faces.push(s),this._soundMeshGeometry.faces.push(t),p+=4}this.destroy(),this._soundMeshGeometry.computeFaceNormals(),this._currentMesh=new a.Mesh(this._soundMeshGeometry,o),this._scene.add(this._currentMesh)},i.prototype.destroy=function(){this._currentMesh&&(this._scene.remove(this._currentMesh),this._currentMesh=null)},i.prototype.update=function(a){for(var b=this._soundMeshGeometry.vertices.length-1;b>=0;b--)this._soundMeshGeometry.vertices[b].y=this._getYToApplyFromTwoPoints(a,this._soundMeshGeometry.vertices[b]);this._soundMeshGeometry.computeFaceNormals(),this._soundMeshGeometry.normalsNeedUpdate=!0,this._soundMeshGeometry.verticesNeedUpdate=!0},i.prototype._getYToApplyFromTwoPoints=function(a,b,c){var d=Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.z-b.z)*(a.z-b.z)),e=0;if(g>d){var f=(g-d)/20*(g-d)/20;e=f*a.y*h}return c||(e+=this._getOscillatorYForDistance(d)),e},i.prototype._getOscillatorYForDistance=function(a){var b=0;g>a&&(b=(g-a)/g);var c=d.getCurrentFrequency()*a/700;return b*Math.cos(c)*10*d.getCurrentGain()},i}]),angular.module("chesireApp").factory("VisualizationKeyHelper",["SpaceConverter","CurrentSynth","MultiNotesHelper",function(a,b,c){var d=null,e=10,f=null,g=null,h=function(){g=b.getCurrentSynth(),b.subscribeToChangesInCurrentSynth(i)},i=function(){g=b.getCurrentSynth(),f=!1,g&&g.synthElements&&(f=g.synthElements[0])},j=function(a){for(var b=0;b<d.length;b++)if(a>=d[b].start&&a<d[b].end)return!0;return!1},k=function(){return f.oscillatorCollection.getNodes()[0].oscillator.frequency.value},l=function(){return f.gainController.gain.value},m=function(){var b=c.getChordsPosition();d=[];for(var f=a.getBoxSize(),g=a.getBoxLimits(),h=0;h<b.length;h++){var i=f.width*b[h].middle+g.xMin;d.push({start:i-e/2,middle:i,end:i+e/2})}},n=function(){return d},o=function(a){return c.getChordsRelevanceFromX(a)};return h(),{createKeyRanges:m,isParticleInKey:j,getKeyRanges:n,getCurrentFrequency:k,getCurrentGain:l,getKeyRangesVolume:o}}]),angular.module("chesireApp").factory("Camera",["Three","SpaceConverter",function(a,b){var c=50,d=425,e=function(a,b){this._scene=a,this._options=b,this._createCamera()};return e.prototype.getCamera=function(){return this.camera},e.prototype._createCamera=function(){var e=b.getBoxCenter();this.camera=new a.PerspectiveCamera(45,this._options.screenWidth/this._options.screenHeight,.1,1e3),this.camera.position.x=e.x,this.camera.position.y=e.y+c,this.camera.position.z=d,this.camera.lookAt(new a.Vector3(e.x,e.y,0))},e}]),angular.module("chesireApp").factory("ChordsHelperModel",["Three","Colorpalette","SpaceConverter","VisualizationKeyHelper",function(a,b,c,d){var e=.05,f=.3,g=function(a){this._scene=a,this._sceneDimensions=c.getBoxLimits(),this._createChordsHelper()};return g.prototype.update=function(a){for(var b=d.getKeyRangesVolume(a),c=0;c<b.length;c++)this._updateChordWithVolume(c,b[c])},g.prototype._updateChordWithVolume=function(a,b){var c=e+(f-e)*b;this._chordsMesh[a].material.opacity=c},g.prototype._createChordsHelper=function(){this._createChordsGeometry(),this._createMesh()},g.prototype.destroy=function(){if(this._chordsMesh){for(var a=0;a<this._chordsMesh.length;a++)this._scene.remove(this._chordsMesh[a]);this._chordsMesh=[]}},g.prototype._createMesh=function(){this._chordsMesh=[];for(var b=0;b<this._chordsMeshGeometry.length;b++)this._chordsMeshGeometry[b].computeFaceNormals(),this._chordsMesh.push(new a.Mesh(this._chordsMeshGeometry[b],this._getMaterial())),this._scene.add(this._chordsMesh[b])},g.prototype._getMaterial=function(){return new a.MeshLambertMaterial({color:b.hex.PARTICLES_NOTE,transparent:!0,opacity:e})},g.prototype._createChordsGeometry=function(){this._chordsMeshGeometry=[];for(var a=d.getKeyRanges(),b=0;b<a.length;b++)this._chordsMeshGeometry[b]=this._createGeometryForChord(a[b])},g.prototype._createGeometryForChord=function(b){var c=new a.Geometry;return c.vertices.push(new a.Vector3(b.start,this._sceneDimensions.yMin,this._sceneDimensions.zMin)),c.vertices.push(new a.Vector3(b.start,this._sceneDimensions.yMax,this._sceneDimensions.zMin)),c.vertices.push(new a.Vector3(b.start,this._sceneDimensions.yMin,this._sceneDimensions.zMax)),c.vertices.push(new a.Vector3(b.start,this._sceneDimensions.yMax,this._sceneDimensions.zMax)),c.vertices.push(new a.Vector3(b.end,this._sceneDimensions.yMin,this._sceneDimensions.zMin)),c.vertices.push(new a.Vector3(b.end,this._sceneDimensions.yMax,this._sceneDimensions.zMin)),c.vertices.push(new a.Vector3(b.end,this._sceneDimensions.yMin,this._sceneDimensions.zMax)),c.vertices.push(new a.Vector3(b.end,this._sceneDimensions.yMax,this._sceneDimensions.zMax)),c.faces.push(new a.Face3(1,2,0)),c.faces.push(new a.Face3(1,3,2)),c.faces.push(new a.Face3(0,2,1)),c.faces.push(new a.Face3(1,2,3)),c.faces.push(new a.Face3(5,6,4)),c.faces.push(new a.Face3(5,7,6)),c.faces.push(new a.Face3(4,6,5)),c.faces.push(new a.Face3(5,6,7)),c.faces.push(new a.Face3(2,3,6)),c.faces.push(new a.Face3(2,6,3)),c.faces.push(new a.Face3(3,7,6)),c.faces.push(new a.Face3(3,6,7)),c},g}]),angular.module("chesireApp").constant("MotionParamsList",["x","y","z","handVelocity","handDirectionX","handDirectionY","handDirectionZ","fingerVelocity","handAperture","fingerDirectionY"]),angular.module("chesireApp").factory("MotionParamsHelper",["ResponseFunctions",function(a){var b=function(b,c){var d=a[b.responseFunction.name],e=c[b.param];return d.getResponse(e,b.responseFunction)};return{getParamValue:b}}]),angular.module("chesireApp").constant("DefaultScale",{name:"Default",chords:[{notes:[{name:"A4",freq:440,midi:69}]},{notes:[{name:"A4",freq:440,midi:69}]}]}),angular.module("chesireApp").factory("DefaultSynth",["AvailableOscillators",function(a){return{name:"Default synth",components:[{type:"oscillator",oscillatorType:a[1],snapDistance:.35,controls:{gain:{param:"y",responseFunction:{name:"linear",min:0,max:.9,inverse:!0}}}}],controls:[{number:7,param:"z",responseFunction:{name:"linear",min:0,max:1,inverse:!0}}]}}]),angular.module("chesireApp").factory("ScalesHelper",["NoteList",function(a){var b=a,c=function(a,b){var c=!0,d={},e={};return angular.forEach(a.notes,function(a){d[a.name]=!0}),angular.forEach(b.notes,function(a){e[a.name]=!0}),angular.forEach(d,function(a,b){return e[b]?void 0:(c=!1,!1)}),angular.forEach(e,function(a,b){return d[b]?void 0:(c=!1,!1)}),c},d=function(a,b){if(!a||!b)return!1;var d=!0;if(a.length===b.length){for(var e=0;e<a.length;e++)if(!c(a[e],b[e])){d=!1;break}}else d=!1;return d},e=function(){return{name:"No name",notes:[]}};return{getAllNotes:function(){return b},isSameChord:c,isSameSetOfChords:d,getEmptyChord:e}}]),angular.module("chesireApp").constant("NoteList",[{name:"C3",freq:130.81,midi:48},{name:"C#3",freq:138.59,midi:49},{name:"D3",freq:146.83,midi:50},{name:"D#3",freq:155.56,midi:51},{name:"E3",freq:164.81,midi:52},{name:"F3",freq:174.61,midi:53},{name:"F#3",freq:185,midi:54},{name:"G3",freq:196,midi:55},{name:"G#3",freq:207.65,midi:56},{name:"A3",freq:220,midi:57},{name:"A#3",freq:233.08,midi:58},{name:"B3",freq:246.94,midi:59},{name:"C4",freq:261.63,midi:60},{name:"C#4",freq:277.18,midi:61},{name:"D4",freq:293.66,midi:62},{name:"D#4",freq:311.13,midi:63},{name:"E4",freq:329.63,midi:64},{name:"F4",freq:349.23,midi:65},{name:"F#4",freq:369.99,midi:66},{name:"G4",freq:392,midi:67},{name:"G#4",freq:415.3,midi:68},{name:"A4",freq:440,midi:69},{name:"A#4",freq:466.16,midi:70},{name:"B4",freq:493.88,midi:71},{name:"C5",freq:523.25,midi:72},{name:"C#5",freq:554.37,midi:73},{name:"D5",freq:587.33,midi:74},{name:"D#5",freq:622.25,midi:75},{name:"E5",freq:659.25,midi:76},{name:"F5",freq:698.46,midi:77},{name:"F#5",freq:739.99,midi:78},{name:"G5",freq:783.99,midi:79},{name:"G#5",freq:830.61,midi:80},{name:"A5",freq:880,midi:81},{name:"A#5",freq:932.33,midi:82},{name:"B5",freq:987.77,midi:83},{name:"C6",freq:1046.5,midi:84},{name:"C#6",freq:1108.73,midi:85},{name:"D6",freq:1174.66,midi:86},{name:"D#6",freq:1244.51,midi:87},{name:"E6",freq:1318.51,midi:88},{name:"F6",freq:1396.91,midi:89},{name:"F#6",freq:1479.98,midi:90},{name:"G6",freq:1567.98,midi:91},{name:"G#6",freq:1661.22,midi:92},{name:"A6",freq:1760,midi:93},{name:"A#6",freq:1864.66,midi:94},{name:"B6",freq:1975.53,midi:95},{name:"C7",freq:2093,midi:96},{name:"C#7",freq:2217.46,midi:97},{name:"D7",freq:2349.32,midi:98}]),angular.module("chesireApp").factory("MultiNotesHelper",["SynthOptions","ScaleOptions","SynthOptionsHelper",function(a,b,c){var d=null,e=null,f=null,g=null,h=null,i=.05,j=.95,k=function(){a.getSynthOptions().then(function(b){g=b,a.subscribeToChangesInSynthOptions(l)}),b.getScaleOptions().then(function(a){h=a,o(h),b.subscribeToChangesInScaleOptions(m)})},l=function(a){g=a,o(h,g)},m=function(a){h=a,o(h,g)},n=function(){angular.forEach(d,function(a){a.gain=0})},o=function(a,b){if(a&&b){var e=b;b.components&&(e=c.getOscillatorFromOptions(b)),d=[],f=a,"glissando"===e.transitionType?p(a):"volume"===e.transitionType&&q(a),n()}},p=function(a){var b=0,c=!1;angular.forEach(a.chords,function(a,d){b<a.notes.length&&(b=a.notes.length,c=d)});for(var e=0;b>e;e++)d.push(a.chords[c].notes[e])},q=function(a){e={};var b=0;angular.forEach(a.chords,function(a){angular.forEach(a.notes,function(a){angular.isNumber(e[a.name])||(e[a.name]=b,d.push(a),b++)})})},r=function(a,b){return b>a?0:a>=b&&1-b>a?(a-b)/(1-2*b):1},s=function(a,b){return"glissando"===b?x(a):"volume"===b?u(a):void 0},t=function(a,b){return d||o(a,b),d},u=function(a){var b,c=v(a),f={};n();for(var g=0;g<c.firstChord.length;g++)b=e[c.firstChord[g].name],d[b].freqToPlay=d[b].freq,d[b].gain=1-c.distanceInBetween,f[c.firstChord[g].name]=!0;for(g=0;g<c.secondChord.length;g++)b=e[c.secondChord[g].name],d[b].freqToPlay=d[b].freq,f[c.secondChord[g].name]?d[b].gain=1:d[b].gain=c.distanceInBetween;return w(d),d},v=function(a){var b=y(a,f.chords.length),d=Math.floor(b);d>=f.chords.length-1&&(d-=1);var e=b-d,h=c.getOscillatorFromOptions(g);e=r(e,h.snapDistance),n();var i=f.chords[d].notes,j=f.chords[d+1].notes;return{firstChord:i,secondChord:j,distanceInBetween:e}},w=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].gain;if(b>0)for(c=0;c<a.length;c++)a[c].unnormalizedGain=a[c].gain,a[c].gain=a[c].gain/b},x=function(a){var b,c,e=v(a);n();for(var f=0;f<d.length;f++)e.firstChord[f]&&e.firstChord[f].freq&&e.secondChord[f]&&e.secondChord[f].freq?(b=e.firstChord[f].freq,c=e.secondChord[f].freq,d[f].freqToPlay=b+(c-b)*e.distanceInBetween,d[f].gain=1):e.firstChord[f]&&e.firstChord[f].freq?(d[f].gain=1-e.distanceInBetween,d[f].freqToPlay=e.firstChord[f].freq):e.secondChord[f]&&e.secondChord[f].freq?(d[f].gain=e.distanceInBetween,d[f].freqToPlay=e.secondChord[f].freq):d[f].gain=0;return w(d),d},y=function(a,b){var c;return c=i>=a?0:a>=j?b-1:(b-1)*(a-i)/(j-i)},z=function(a){var b=y(a,f.chords.length),d=Math.floor(b);d>=f.chords.length-1&&(d-=1);var e=b-d,h=c.getOscillatorFromOptions(g);e=r(e,h.snapDistance);for(var i=[],j=0;j<f.chords.length;j++){var k=0;j===d?k=1-e:j===d+1&&(k=e),i.push(k)}return i},A=function(){var a=[];if(f.chords.length>1)for(var b=(j-i)/(f.chords.length-1),c=0;c<f.chords.length;c++)a.push({middle:b*c+i});return a};return k(),{changeNotes:o,getNotesInfo:s,getNotesDefinition:t,getChordsRelevanceFromX:z,getChordsPosition:A}}]),angular.module("chesireApp").directive("chord",function(){return{templateUrl:"scripts/chords/chord.html",restrict:"E",scope:{chordInfo:"=",chordsArray:"=",chordIndex:"=",onChordChange:"="},controller:"ChordCtrl"}}),angular.module("chesireApp").controller("ChordCtrl",["$scope","$window","ScalesHelper","ChordStore",function(a,b,c,d){var e=function(){a.allNotes=angular.copy(c.getAllNotes()),a.$watch("chordInfo.name",a.selectedChordChanged,!0),a.$watch("chordAlreadyExisting",g,!0),d.getChords().then(f),d.subscribeToChangeInAllChords(f),a.updateSelectedNotes()};a.selectedChordChanged=function(){a.updateSelectedNotes(),a.onChordChange(a.chordIndex,a.chordInfo)},a.updateSelectedNotes=function(){angular.forEach(a.allNotes,function(a){a.selected=!1}),angular.forEach(a.chordInfo.notes,function(b){angular.forEach(a.allNotes,function(a){a.name===b.name&&(a.selected=!0)})})},a.onNameFocus=function(){a.showSelectorList=!0},a.onNameBlur=function(){a.showSelectorList=!1},a.selectChord=function(b){a.chordInfo=angular.copy(b),f(a.allChords)},a.selectNote=function(b){angular.forEach(a.allNotes,function(c){c.name===b&&(c.selected?a.chordInfo.notes=_.without(a.chordInfo.notes,_.findWhere(a.chordInfo.notes,{name:b})):a.chordInfo.notes.push(c),c.selected=!c.selected)}),f(a.allChords),a.onChordChange(a.chordIndex,a.chordInfo)};var f=function(b){a.allChords=b,a.chordAlreadyExisting=!1,angular.forEach(b,function(b){c.isSameChord(b,a.chordInfo)&&(a.chordAlreadyExisting=!0,a.chordInfo=angular.copy(b))}),a.chordAlreadyExisting||(a.chordInfo.name="")},g=function(b){b||(a.chordInfo.name="")};a.saveChord=function(){a.loading=!0,d.saveChord(a.chordInfo)["finally"](function(){a.loading=!1})},a.deleteChord=function(){a.loading=!0,d.deleteChord(a.chordInfo)["finally"](function(){a.loading=!1})},e()}]),angular.module("chesireApp").factory("ChordStore",["$q","localStorageService",function(a,b){var c=[],d=function(){var c=a.defer();return c.resolve(b.get("chords")||[]),c.promise},e=function(c){var d=a.defer();if(c&&c.name&&c.notes&&c.notes.length){var e=b.get("chords");e=e?angular.fromJson(e):[];var f=g(c,e);f?f.notes=c.notes:e.push(c),b.set("chords",e),d.promise.then(j),d.resolve(e)}else d.reject("Error saving chord, bad config");return d.promise},f=function(c){var d=a.defer(),e=b.get("chords"),f=g(c,e);return e=_.without(e,f),b.set("chords",e),d.promise.then(j),d.resolve(e),d.promise},g=function(a,b){for(var c=0;c<b.length;c++)if(b[c].name===a.name)return b[c];return!1},h=function(a){c.push(a)},i=function(a){c=_.without(c,a)},j=function(a){angular.forEach(c,function(b){b(a)})};return{getChords:d,saveChord:e,deleteChord:f,subscribeToChangeInAllChords:h,unsubscribeToChangeInAllChords:i}}]),angular.module("chesireApp").directive("switchTwoValues",function(){return{templateUrl:"scripts/switch-two-values/switch-two-values.html",restrict:"E",scope:{values:"=",bindModel:"=ngModel"},controller:"SwitchTwoValuesCtrl"}}),angular.module("chesireApp").controller("SwitchTwoValuesCtrl",["$scope",function(a){var b=function(){a.bindModel||(a.bindModel=a.values[0].value)};a.selectValue=function(b){a.bindModel=b},b()}]),angular.module("chesireApp").controller("OscillatorCtrl",["$scope","CurrentSynth","AvailableOscillators","SynthOptions","SynthOptionsHelper",function(a,b,c,d,e){var f=null,g=_.throttle(d.notifyComponentChanged,500),h=function(){f=b.getCurrentSynth(),a.transitionTypes=[{name:"Glissando",value:"glissando"},{name:"Volume",value:"volume"}],a.AvailableOscillators=c,a.$watch(function(){return b.getCurrentSynth()},i),a.$watchCollection(function(){return a.synthComponent.oscillatorCollection.getNodes()},j),d.getSynthOptions().then(function(a){l(a),d.subscribeToChangesInSynthOptions(l)}),a.$watch("gainControllerInfo",m,!0),a.$watch("componentInfo.transitionType",k),a.$watch("componentInfo.snapDistance",k),a.$watch("componentInfo.oscillatorType",k)},i=function(){f=b.getCurrentSynth(),a.synthComponent=f.getComponent(a.componentInfo)},j=function(){a.oscillatorNodes=a.synthComponent.oscillatorCollection.getNodes()},k=function(){d.notifyComponentChanged(a.componentInfo)},l=function(b){if(b&&b.controls){var c=e.getOscillatorFromOptions(b);a.gainControllerInfo=c.controls.gain}a.synthOptions=b,"midi"===a.synthOptions.outputMode&&(a.componentInfo.transitionType="volume")},m=function(b,c){_.isEqual(b,c)||g(a.componentInfo)};a.isMidiOutput=function(){return a.synthOptions?"midi"===a.synthOptions.outputMode:!1},a.getLeftPercentageFromNode=function(b){return 100*Math.log2(b.oscillator.frequency.value/a.frequencySpectrumSize)},a.oscillatorTypeChanged=function(){d.notifyComponentChanged(a.componentInfo)},a.toggleListOfOscillatorType=function(){a.listOfOscillatorTypeExpanded=!a.listOfOscillatorTypeExpanded},h()}]),angular.module("chesireApp").directive("oscillator",function(){return{templateUrl:"scripts/oscillator/oscillator.html",restrict:"E",controller:"OscillatorCtrl"}}),angular.module("chesireApp").directive("oscillatorSnap",function(){return{templateUrl:"scripts/oscillator/oscillator-snap.html",restrict:"E",scope:{componentInfo:"="}}}),angular.module("chesireApp").directive("midigenerator",function(){return{restrict:"E",templateUrl:"scripts/midi/midi-generator.html",scope:{},controller:"MidigeneratorCtrl"}}),angular.module("chesireApp").controller("MidigeneratorCtrl",["$scope","$timeout","$window","$q","MidiApiMediator","Leapmotion","MultiNotesHelper","SynthOptions","MotionParamsHelper","SynthOptionsHelper","CurrentMidiOutput",function(a,b,c,d,e,f,g,h,i,j,k){var l=null,m={},n=1,o=function(){var b=h.getSynthOptions();d.all([e,b]).then(function(b){var c=b[0],d=b[1];a.midiOutputs=c.outputs(),k.setCurrentOutput(a.midiOutputs[0]),p(d),h.subscribeToChangesInSynthOptions(p),f.subscribeToFrameChange(q)})},p=function(a){a&&(k.getCurrentOutput().resetEverything(),l=a,"midi"!==a.outputMode,"midi"===a.outputMode)},q=function(a){var b=r(a.frame);s(b,a.frame)},r=function(a){var b=[];if(a&&a.hands&&a.hands.length){var c=f.getRelativePositions(a,a.hands),d=j.getOscillatorFromOptions(l);b=g.getNotesInfo(c.x,d.transitionType)}else v();return b},s=function(a,b){var c=[],d=[],e=[];angular.forEach(a,function(a){a.gain?m[a.name]?e.push(a):(c.push(a),m[a.name]=a):m[a.name]&&(d.push(a),m[a.name]=!1)}),k.getCurrentOutput().notesOff(d),k.getCurrentOutput().notesOn(c),k.getCurrentOutput().keyPressureChanges(e),t(b),u(b)},t=function(a){if(a&&!_.isEmpty(a.hands)){var b=f.getRelativePositions(a,a.hands),c=n,d=j.getOscillatorFromOptions(l);d.controls&&d.controls.gain&&(c=i.getParamValue(d.controls.gain,b)),k.getCurrentOutput().updateMainVolume(c)}},u=function(a){if(a&&!_.isEmpty(a.hands)){var b=f.getRelativePositions(a,a.hands);angular.forEach(l.controls,function(a){var c=i.getParamValue(a,b);k.getCurrentOutput().updateControl(a,c)})}},v=function(){_.isEmpty(m)||(k.getCurrentOutput().allOff(_.toArray(m)),m={})};o()}]),angular.module("chesireApp").factory("MidiApiMediator",["$q","MidiAccess",function(a,b){var c=a.defer(),d=function(){navigator.requestMIDIAccess?navigator.requestMIDIAccess({sysex:!1}).then(function(a){c.resolve(new b(a))},e):e()},e=function(){throw"No MIDI support in your browser."};return d(),c.promise}]).factory("MidiAccess",["MidiOutput",function(a){var b=function(a){if(!a)throw"Error creating MidiAccess object: we need the JazzMidi object";this.nativeMidiAccess=a};return b.prototype.outputs=function(){var b=[];return this.nativeMidiAccess.outputs.forEach(function(c){b.push(new a(this,c))}),b},b}]).service("MidiOutput",["MidiMessagesHelper",function(a){var b=null,c=function(a,c){this.id=c.id,this.name=c.name,b=c},d=function(a){b.send(a)};return c.prototype.send=d,c.prototype.notesOff=function(b){angular.forEach(b,function(b){b&&d(a.getNoteOff(b))})},c.prototype.notesOn=function(b){angular.forEach(b,function(b){d(a.getNoteOn(b))})},c.prototype.keyPressureChanges=function(b){angular.forEach(b,function(b){d(a.getKeyPressureChange(b))})},c.prototype.allOff=function(b){angular.forEach(b,function(b){b&&d(a.getNoteOff(b))})},c.prototype.updateMainVolume=function(b){d(a.getMainVolume(b))},c.prototype.updateControl=function(b,c){d(a.getControl(b,c))},c.prototype.resetEverything=function(){d(a.getResetControls()),d(a.getResetNotes())},c.prototype.pingControl=function(b){d(a.getPingControl(b))},c}]),angular.module("chesireApp").factory("MidiMessagesHelper",function(){var a=0,b=function(a){return parseInt(Math.floor(127*a),10)},c=function(){return 144+a},d=function(){return 128+a},e=function(){return 160+a},f=function(){return 176+a},g=function(a){var d=c(),e=b(a.unnormalizedGain);return 0>=e&&(e=1),[d,a.midi,e]},h=function(a){var c=e();return[c,a.midi,b(a.unnormalizedGain)]},i=function(a){var b=d();return[b,a.midi,0]},j=function(){return[123]},k=function(a){var c=f();return[c,7,b(a)]},l=function(a){var b=0,c=1,d=a.midi,e=45,f=50,g=50;return[240,127,0,8,2,b,c,d,e,f,g,247]},m=function(a,c){return[f(),a.number,b(c)]},n=function(){var a=f();return[a,121,0]},o=function(){var a=f();return[a,123,0]},p=function(a){return[f(),a,80]};return{getNoteOn:g,getNoteOff:i,getKeyPressureChange:h,getAllNotesOff:j,getMainVolume:k,getNoteTune:l,getControl:m,getResetControls:n,getResetNotes:o,getPingControl:p}}),angular.module("chesireApp").directive("testmidi",function(){return{restrict:"E",templateUrl:"scripts/midi/testmidi.html",scope:{},controller:["$scope","$q","SynthOptions","MidiApiMediator","MidiMessagesHelper",function(a,b,c,d,e){var f=null,g=c.getSynthOptions();b.all([d,g]).then(function(b){var d=b[0],e=b[1];a.midiOutputs=d.outputs(),a.selectedMidiOutput=a.midiOutputs[0],h(e),c.subscribeToChangesInSynthOptions(h)});var h=function(a){f=a};a.start=function(){var b={midi:69,unnormalizedGain:0},c=e.getNoteOn(b);a.selectedMidiOutput.send(c)},a.start2=function(){var b={midi:75,unnormalizedGain:.2},c=e.getNoteOn(b);a.selectedMidiOutput.send(c)},a.middle=function(b){var c={midi:69,unnormalizedGain:parseFloat(b)},d=e.getKeyPressureChange(c);a.selectedMidiOutput.send(d)},a.end=function(){var b={midi:69},c=e.getNoteOff(b);a.selectedMidiOutput.send(c)},a.end2=function(){var b={midi:75},c=e.getNoteOff(b);a.selectedMidiOutput.send(c)},a.tune=function(){var b={midi:69},c=e.getNoteTune(b);a.selectedMidiOutput.send(c)},a.control=function(){var b={midi:69},c=e.getControl(b);a.selectedMidiOutput.send(c)}}]}}),angular.module("chesireApp").constant("MidiControlMessages",[{name:"Bank Select",number:0},{name:"Modulation Wheel or Lever",number:1},{name:"Breath Controller",number:2},{name:"Undefined (3)",number:3},{name:"Foot Controller",number:4},{name:"Portamento Time",number:5},{name:"Data Entry MSB",number:6},{name:"Channel Volume (formerly Main Volume)",number:7},{name:"Balance",number:8},{name:"Undefined (9)",number:9},{name:"Pan",number:10},{name:"Expression Controller",number:11},{name:"Effect Control 1",number:12},{name:"Effect Control 2",number:13},{name:"Undefined (14)",number:14},{name:"Undefined (15)",number:15},{name:"General Purpose Controller 1",number:16},{name:"General Purpose Controller 2",number:17},{name:"General Purpose Controller 3",number:18},{name:"General Purpose Controller 4",number:19},{name:"Undefined (20)",number:20},{name:"Undefined (21)",number:21},{name:"Undefined (22)",number:22},{name:"Undefined (23)",number:23},{name:"Undefined (24)",number:24},{name:"Undefined (25)",number:25},{name:"Undefined (26)",number:26},{name:"Undefined (27)",number:27},{name:"Undefined (28)",number:28},{name:"Undefined (29)",number:29},{name:"Undefined (30)",number:30},{name:"Undefined (31)",number:31},{name:"Damper Pedal on/off (Sustain)",number:64},{name:"Portamento On/Off",number:65},{name:"Sostenuto On/Off",number:66},{name:"Soft Pedal On/Off",number:67},{name:"Legato Footswitch",number:68},{name:"Hold 2",number:69},{name:"Sound Controller 1 (default: Sound Variation)",number:70},{name:"Sound Controller 2 (default: Timbre/Harmonic Intens.)",number:71},{name:"Sound Controller 3 (default: Release Time)",number:72},{name:"Sound Controller 4 (default: Attack Time)",number:73},{name:"Sound Controller 5 (default: Brightness)",number:74},{name:"Sound Controller 6 (default: Decay Time)",number:75},{name:"Sound Controller 7 (default: Vibrato Rate)",number:76},{name:"Sound Controller 8 (default: Vibrato Depth)",number:77},{name:"Sound Controller 9 (default: Vibrato Delay)",number:78},{name:"Sound Controller 10 (default undefined)",number:79}]),angular.module("chesireApp").factory("CurrentMidiOutput",["$q",function(a){var b=null,c=a.defer(),d=!1,e=function(){if(b)return b;throw"MIDIOUTPUT: Error, trying to access current midi output when there is none"},f=function(a){b=a,!d&&a&&(d=!0,c.resolve(a))},g=function(){return c.promise};return{getCurrentOutput:e,setCurrentOutput:f,whenReady:g}}]),angular.module("chesireApp").directive("controlsHud",function(){return{templateUrl:"scripts/controls-hud/controls-hud.html",restrict:"E",scope:{},controller:"ControlsHudCtrl"}}),angular.module("chesireApp").controller("ControlsHudCtrl",["$scope","SynthOptions","SynthOptionsHelper","MidiControlMessages",function(a,b,c,d){var e=null,f=function(){b.getSynthOptions().then(function(a){b.subscribeToChangesInSynthOptions(g),g(a)})},g=function(b){_.isEqual(b,e)||(e=b,a.controls=b.controls,a.oscillator=c.getOscillatorFromOptions(b))};a.getMidiParamFromOptions=function(a){return _.findWhere(d,{number:a.number})},f()}]),angular.module("chesireApp").directive("singleControlHud",function(){return{templateUrl:"scripts/controls-hud/single-control-hud.html",restrict:"E",scope:{controlInfo:"=",relatedParam:"@"},controller:"SingleControlHudCtrl"}}),angular.module("chesireApp").controller("SingleControlHudCtrl",["$scope","Leapmotion","MotionParamsHelper",function(a,b,c){var d=function(){b.subscribeToFrameChange(e)},e=function(d){var e=d.frame;if(e&&!_.isEmpty(e.hands)){var f=b.getRelativePositions(e,e.hands);a.outputValue=Math.round(100*c.getParamValue(a.controlInfo,f))}};d()}]),angular.module("chesireApp").run(["$templateCache",function(a){a.put("scripts/app/main.html",'<div class="header"> <scaleoptions></scaleoptions> <synthoptions></synthoptions> <div class="logo"></div> </div> <!-- Background visualization --> <threeparticles></threeparticles> <soundgenerator></soundgenerator> <midigenerator></midigenerator> <controls-hud></controls-hud> <!-- <testmidi></testmidi> --> <!-- Stats -->'),a.put("scripts/chords/chord.html",'<div class="chord"> <div class="chord-tools"> <div class="chord-selector"> <input ng-focus="onNameFocus()" ng-blur="onNameBlur()" ng-model="chordInfo.name"> <button class="button" ng-click="saveChord()" ng-disabled="!chordInfo.name">Save chord</button> <button class="button" ng-click="deleteChord()" ng-show="chordAlreadyExisting">Delete chord</button> <div class="chord-selector-list" ng-show="showSelectorList"> <a class="chord-selector-list-item" ng-repeat="chord in allChords" ng-mousedown="selectChord(chord)">{{chord.name}}</a> </div> </div> </div> <ul class="chord-keyboard"> <li class="note" ng-class="{&quot;sharp-note&quot;: (note.name.indexOf(&quot;#&quot;)!==-1)\n                        , &quot;selected&quot;: note.selected}" ng-repeat="note in allNotes"> <div class="note-content"> <button ng-click="selectNote(note.name)" class="note-button"></button> <div class="note-info"> {{note.name}} </div> </div> </li> </ul> </div>'),a.put("scripts/controls-hud/controls-hud.html",'<div class="controls-hud"> <single-control-hud control-info="oscillator.controls.gain" related-param="Volume"></single-control-hud> <single-control-hud ng-repeat="control in controls" control-info="control" related-param="{{getMidiParamFromOptions(control).name}}"></single-control-hud> </div>'),a.put("scripts/controls-hud/single-control-hud.html",'<div class="single-control-hud"> <div class="single-control-hud-content"> <div class="single-control-hud-param"> {{relatedParam}} </div> <div class="single-control-hud-gesture"> {{controlInfo.param}} </div> </div> <div class="single-control-hud-value" style="width: {{outputValue}}%"> </div> </div>'),a.put("scripts/custom-checkbox/custom-checkbox.html",'<div class="custom-checkbox"> <label ng-class="{&quot;checked&quot;: value}"> <input type="checkbox" ng-model="value"> </label> </div>'),a.put("scripts/midi/midi-generator.html",'<div class="midigenerator"> <ul> <li ng-repeat="midiOutput in midiOutputs"> {{midiOutput.name}} </li> </ul> <!-- <ul>\n        <li ng-repeat="note in notesBeingPlayed">\n            {{note.name}} - {{note.unnormalizedGain}}\n        </li>\n    </ul> --> <!--     <p>last notesOn</p>\n    <ul>\n        <li ng-repeat="note in lastNotesOn">\n            {{note.name}} - {{note.unnormalizedGain}}\n        </li>\n    </ul>\n    <p>notesOff</p>\n    <ul>\n        <li ng-repeat="note in lastNotesOff">\n            {{note.name}} - {{note.unnormalizedGain}}\n        </li>\n    </ul>\n     --> <p>notesUpdate</p> <ul> <li ng-repeat="note in notesUpdate"> {{note.name}} - {{note.unnormalizedGain}} </li> </ul></div>'),a.put("scripts/midi/testmidi.html",'<div class="testmidi"> <button ng-click="start()">Iniciar</button> <button ng-click="start2()">Iniciar2</button> <button ng-click="tune()">Tune1</button> <button ng-click="control()">Control</button> <button ng-click="middle(0)">0</button> <button ng-click="middle(0.2)">0.2</button> <button ng-click="middle(0.4)">0.4</button> <button ng-click="middle(0.6)">0.6</button> <button ng-click="middle(0.8)">0.8</button> <button ng-click="middle(1)">1</button> <button ng-click="end()">Fin</button> <button ng-click="end2()">Fin2</button> </div>'),a.put("scripts/oscillator/oscillator-snap.html",'<div class="oscillator-snap-info"> <div class="oscillator-snap-info-first-note" style="width: {{100*componentInfo.snapDistance}}%"></div> <div class="oscillator-snap-info-middle" style="width: {{100*(1 - 2*componentInfo.snapDistance)}}%; left: {{100*componentInfo.snapDistance}}%"></div> <div class="oscillator-snap-info-second-note" style="width: {{100*componentInfo.snapDistance}}%"></div> </div> <input class="oscillator-snap-range-picker" id="test" type="range" min="0" max="0.5" step="0.01" ng-model="componentInfo.snapDistance">'),a.put("scripts/oscillator/oscillator.html",'<div class="oscillator"> <div class="oscillator-section" ng-hide="isMidiOutput()"> <h4 class="oscillator-section-title">Oscillator type</h4> <div class="oscillator-section-content"> <select-box value="componentInfo.oscillatorType" value-list="AvailableOscillators"></select-box> </div> </div> <div class="oscillator-transition oscillator-section" ng-hide="isMidiOutput()"> <h4 class="oscillator-section-title">Transition between chords</h4> <div class="oscillator-section-content"> <switch-two-values values="transitionTypes" ng-model="componentInfo.transitionType"></switch-two-values> </div> </div> <!-- <div class=\'oscillator-nodes-info oscillator-section\'>\n        <h4>Frequencies being played</h4>\n        <ul class=\'oscillator-nodes\'>\n            <li ng-repeat=\'node in oscillatorNodes\'\n                class=\'oscillator-node\'\n                style=\'left: {{node.oscillator.frequency.value | frequencyToPercentage}}%; height: {{node.gainNode.gain.value * synthComponent.gainController.gain.value * 100}}%\'>\n            </li>\n        </ul>\n    </div> --> <div class="oscillator-section"> <h4 class="oscillator-section-title">Volume control</h4> <div class="oscillator-section-content"> <gesture-selector gesture-object="gainControllerInfo"></gesture-selector> </div> </div> <div class="oscillator-snap oscillator-section"> <h4 class="oscillator-section-title">Snap to chords</h4> <div class="oscillator-section-content"> <oscillator-snap component-info="componentInfo"></oscillator-snap> </div> </div> </div>'),
a.put("scripts/scale-options/scale-options.html",'<div class="scaleoptions"> <div class="config-menu-header" ng-class="{&quot;all-songs-list-expanded&quot;: listOfSongsExpanded}" ng-hide="expanded"> <button class="big-button config-menu-title" ng-click="toggle()"> {{currentScale.name || "No name"}} <span class="config-menu-title-decorator"></span> </button> <button class="big-button config-menu-list-toggle" ng-click="toggleListOfSongs()"></button> <ul class="config-menu-list" ng-show="listOfSongsExpanded"> <li class="config-menu-list-item" ng-repeat="song in availableSongs"> <a class="config-menu-list-item-link" ng-click="selectSong(song)">{{song.name}}</a> </li> </ul> </div> <div class="config-menu-content" ng-show="expanded"> <input type="text" ng-model="currentScale.name"> <button class="button" ng-click="saveSong()" ng-disabled="!currentScale.name">Save song</button> <button class="button" ng-click="deleteSong()">Delete song</button> <button class="big-button config-menu-close" ng-click="toggle()"></button> <ul> <li class="scale-options-chord-item" ng-repeat="chord in currentScale.chords"> <chord chord-info="chord" chord-index="$index" chords-array="currentScale.chords" on-chord-change="onChordChange"> </chord> <button class="big-button scale-options-remove-chord" ng-disabled="currentScale.chords.length<=2" ng-click="removeChordFromSong($index)"> <span class="scale-options-remove-chord-help">Remove chord from song</span> </button> </li> </ul> <button class="big-button scale-options-add-chord" ng-click="addChord()">Add chord</button> </div> </div>'),a.put("scripts/select-box/select-box.html",'<div class="select-box"> <a class="select-box-value" ng-click="toggleList()">{{value[attrToShow] || value}}</a> <button class="select-box-value-toggle" ng-click="toggleList()"></button> <ul class="select-box-list" ng-show="listExpanded"> <li class="select-box-list-item" ng-repeat="eachValue in valueList"> <a class="select-box-list-link" ng-click="selectValue(eachValue)">{{eachValue[attrToShow] || eachValue}}</a> </li> </ul> </div>'),a.put("scripts/sound-generator/sound-generator.html",'<div class="soundgenerator"> <ul> <li class="soundgenerator-chord" ng-repeat="note in notesInfo"> {{note.freqToPlay | number:2 }}Hz | {{note.gain | number:2 }} </li> </ul> </div>'),a.put("scripts/switch-two-values/switch-two-values.html",'<ul class="switch-two-values"> <li class="switch-two-values-item" ng-repeat="value in values" ng-class="{ &quot;selected&quot;: (value.value === bindModel)}" ng-click="selectValue(value.value)"> {{value.name}} </li> </ul>'),a.put("scripts/synth-options/control.html",'<div class="control"> <div class="control-title"> <div class="control-title-text"> Parameter: </div> <div class="control-title-select"> <select-box value="currentControlMessage" value-list="midiControlMessages" attr-to-show="name"></select-box> </div> </div> <div class="control-content"> <gesture-selector gesture-object="controlInfo"></gesture-selector> </div> <div class="control-remove"> <button class="button" ng-click="pingControl()">Ping control</button> <button class="button" ng-click="removeControl()">Remove control</button> </div> </div>'),a.put("scripts/synth-options/gesture-selector.html",'<div class="gesture-selector"> <div class="gesture-selector-gesture"> <div class="gesture-selector-gesture-label"> Gesture: </div> <div class="gesture-selector-gesture-select"> <select-box value="gestureObject.param" value-list="availableGestures"></select-box> </div> </div> <div class="gesture-selector-response"> <div class="gesture-selector-response-label"> Response: </div> <div class="gesture-selector-response-select"> <response-function response-function-info="gestureObject.responseFunction"></response-function> </div> </div> </div>'),a.put("scripts/synth-options/midi-output-selector/midi-output-selector.html",'<select-box value="selectedMidiOutput" value-list="midiOutputs" attr-to-show="name"></select-box>'),a.put("scripts/synth-options/response-function-param.html",'<div class="response-function-param"> <div class="response-function-param-name"> {{paramInfo.name}} </div> <div class="response-function-param-value"> <input ng-show="isNumber" type="range" min="0" max="1" step="0.01" ng-model="selectedValue"> <!-- <input ng-show=\'isBoolean\' type="checkbox" ng-model="selectedValue"/> --> <custom-checkbox ng-show="isBoolean" value="selectedValue"></custom-checkbox> </div> </div>'),a.put("scripts/synth-options/response-function.html",'<!-- TODO: use parameters coming from the info --><!-- <div>\n    <p> Min = {{responseFunctionInfo.min}}</p>\n    <input type="range" min="0" max="{{responseFunctionInfo.max - 0.01}}" step="0.01" ng-model="responseFunctionInfo.min"/>\n</div>\n<div>\n    <p> Max = {{responseFunctionInfo.max}}</p>\n    <input type="range" min="{{responseFunctionInfo.min + 0.01}}" max="1" step="0.01" ng-model="responseFunctionInfo.max"/>\n</div>\n<label>\n    <input type=\'checkbox\' ng-model="responseFunctionInfo.inverse" />\n    Inverse\n</label> --> <div class="response-function"> <select-box value="selectedResponseFunction" value-list="availableResponseFunctions" attr-to-show="name"></select-box> <div class="response-function-details"> <div class="response-function-graph-container"> <ul class="response-function-graph"> <li ng-repeat="responseValue in responseFunctionValues" class="response-function-graph-value" style="width: {{100*responseFunctionIncrement}}%;\n                           left:  {{100*responseValue.x}}%;\n                           height: {{100*responseValue.y}}%"></li> </ul> </div> <ul class="response-function-params"> <li ng-repeat="(key, param) in selectedResponseFunction.params"> <response-function-param param-parent-object="responseFunctionInfo" param-key="key" param-info="param"></response-function-param> </li> </ul> </div> </div>'),a.put("scripts/synth-options/synth-options.html",'<div class="synthoptions"> <div class="config-menu-header" ng-class="{&quot;all-synths-list-expanded&quot;: listOfSynthsExpanded}" ng-hide="expanded"> <button class="big-button config-menu-title" ng-click="toggle()"> {{synthoptions.name || "No name"}} <span class="config-menu-title-decorator"></span> </button> <button class="big-button config-menu-list-toggle" ng-click="toggleListOfSynths()"></button> <ul class="config-menu-list" ng-show="listOfSynthsExpanded"> <li class="config-menu-list-item" ng-repeat="synth in availableSynths"> <a class="config-menu-list-item-link" ng-click="selectSynth(synth)">{{synth.name}}</a> </li> </ul> </div> <div class="config-menu-content synthoptions-content" ng-show="expanded"> <div class="synthoptions-content-header"> <button class="big-button config-menu-title" ng-click="toggle()"> {{synthoptions.name || "No name"}} <span class="config-menu-title-decorator"></span> </button> </div> <div class="synthoptions-content-body"> <div class="synthoptions-content-presets"> <input type="text" ng-model="synthoptions.name"> <button class="button" ng-click="saveSynth()" ng-disabled="!synthoptions.name">Save synth</button> <button class="button" ng-click="deleteSynth()">Delete synth</button> <button class="big-button config-menu-close" ng-click="toggle()"></button> </div> <div class="synthoptions-content-columns"> <div class="synthoptions-content-components"> <h2 class="synthoptions-content-column-title">Note generation</h2> <div class="oscillator-section"> <h4 class="oscillator-section-title">Output mode</h4> <div class="oscillator-section-content"> <switch-two-values values="outputModes" ng-model="synthoptions.outputMode"></switch-two-values> <div class="synthoptions-midi-output-selector" ng-show="synthoptions.outputMode === &quot;midi&quot;"> <midi-output-selector></midi-output-selector> </div> </div> </div> <ul> <li ng-repeat="component in synthoptions.components"> <synthcomponent component-info="component"></synthcomponent> </li> </ul> </div> <div class="synthoptions-content-controls"> <h2 class="synthoptions-content-column-title">Additional controls</h2> <ul class="synthoptions-midi-controls"> <li ng-repeat="control in synthoptions.controls" trackby> <control control-info="control"></control> </li> </ul> <div class="synthoptions-content-controls-add-control"> <button class="big-button" ng-click="addControl()">Add control</button> </div> </div> </div> </div> </div> </div>')}]);